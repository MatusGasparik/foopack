[workspace]
name = "myapp"
version = "0.1.0"
description = "Downstream application consuming foopack packages"
channels = ["https://repo.prefix.dev/foopack", "https://prefix.dev/conda-forge"]
platforms = ["linux-64", "linux-aarch64", "osx-arm64", "osx-64"]

[dependencies]
python = ">=3.12.0,<3.14"
# foopack packages from prefix.dev
foopack-core = "==0.1.6"
foopack-extras = "==0.1.6"
foopack-ui = "==0.1.6"

##############################################
# Tasks
##############################################
[tasks]
run = "python -m myapp.main"
dashboard = { cmd = "panel serve src/myapp/dashboard.py --show --autoreload", env = { PYTHONPATH = "src" } }
check = '''
python -c "
import foopack_core
import foopack_extras
import foopack_ui
print('âœ“ All foopack packages imported successfully')
print(f'  foopack-core   : {getattr(foopack_core, \"__version__\", \"unknown\")}')
print(f'  foopack-extras : {getattr(foopack_extras, \"__version__\", \"unknown\")}')
print(f'  foopack-ui     : {getattr(foopack_ui, \"__version__\", \"unknown\")}')
"
'''

# Docker multi-platform build tasks
docker-build = """
docker buildx build \
  --platform linux/amd64,linux/arm64 \
  -t ghcr.io/matusgasparik/foopack-app:latest \
  .
"""

docker-push = """
docker buildx build \
  --platform linux/amd64,linux/arm64 \
  -t ghcr.io/matusgasparik/foopack-app:latest \
  --push \
  .
"""
